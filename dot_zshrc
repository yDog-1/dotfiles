# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

#
# Basic ZSH Configuration
#
setopt histignorealldups sharehistory
HISTSIZE=1000
SAVEHIST=1000
HISTFILE=~/.zsh_history

#
# Environment Variables
#
export EDITOR="nvim"
export BROWSER="${BROWSER:-wslview}"
export LANG="ja_JP.UTF-8"
export LANGUAGE="ja_JP:ja"
bindkey -v

#
# Secrets
#
if [ -f ~/.secrets.env ]; then
  source ~/.secrets.env
fi


# Development Tools
#
# Neovim
[ -d "/opt/nvim-linux64/bin" ] && export PATH="$PATH:/opt/nvim-linux64/bin"

# Homebrew
if [ -f "/home/linuxbrew/.linuxbrew/bin/brew" ]; then
  export PATH="/home/linuxbrew/.linuxbrew/bin:$PATH"
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
elif [ -f "/opt/homebrew/bin/brew" ]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif command -v brew >/dev/null 2>&1; then
  eval "$(brew shellenv)"
fi

# Node.js Management
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"
command -v nodenv >/dev/null 2>&1 && eval "$(nodenv init - zsh)"

# Python Management
export PYENV_ROOT="$HOME/.pyenv"
[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"
command -v pyenv >/dev/null 2>&1 && eval "$(pyenv init - zsh)"

# Other Tools
export DPRINT_INSTALL="$HOME/.dprint"
[ -d "$DPRINT_INSTALL/bin" ] && export PATH="$DPRINT_INSTALL/bin:$PATH"
# Terraformがインストールされている場合のみ補完を設定
[ -f "/usr/bin/terraform" ] && complete -C /usr/bin/terraform terraform
# Denoの環境変数ファイルが存在する場合のみ読み込み
[ -f "$HOME/.deno/env" ] && . "$HOME/.deno/env"
[ -f "$HOME/.local/bin/env" ] && . "$HOME/.local/bin/env"

#
# Plugins
#
# sheldonが利用可能な場合のみ実行
command -v sheldon >/dev/null 2>&1 && eval "$(sheldon source)"

#
# Aliases
#
alias ll='ls -alh'
alias cdk='deno run -A npm:aws-cdk@latest'

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f "$HOME/.p10k.zsh" ]] || source "$HOME/.p10k.zsh"

#
# Keybindings
#
# `jj`でノーマルモードに移行
bindkey -M viins 'jj' vi-cmd-mode
# `j` で 履歴を進む
bindkey -M vicmd 'j' down-line-or-history
# `Ctrl - p` で 履歴,メニューを遡る
bindkey -M viins '^P' up-line-or-search
# `Ctrl - o` でNeovimでコマンドを編集
autoload -Uz edit-command-line
zle -N edit-command-line
bindkey "^O" edit-command-line
